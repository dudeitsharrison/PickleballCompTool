<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2034792889395341"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pickle Pairs | Doing Doubles Right</title>
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Pickle Pairs - The Pickleball Matchmaker | Doing Doubles Right">
    <meta property="og:description" content="Pairing picklers for unique matches every round.">
    <meta property="og:image" content="landingpickle.png">
    <meta property="og:url" content="">
    <meta property="og:type" content="website">
    
    <!-- AdSense Verification - Replace content with your actual AdSense publisher ID when provided -->
    <meta name="google-adsense-account" content="ca-pub-XXXXXXXXXXXXXXXX">
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        /* Logo Flip Animation Styles */
        .logo-flip-container {
            perspective: 1000px;
            width: 200px;
            height: 200px;
            margin: 0 auto;
            cursor: pointer;
        }
        
        .logo-flipper {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        .logo-flip-container:hover .logo-flipper {
            transform: rotateY(180deg);
        }
        
        .logo-front, .logo-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo-back {
            transform: rotateY(180deg);
        }
        
        .back-logo {
            transform: scale(1.2); /* Zoomed in slightly */
        }
        
        /* Header logo specific styles */
        .header-logo-flip {
            width: 100px;
            height: 100px;
        }
        
        .header-logo-flip .logo-flipper {
            transition: transform 0.6s; /* Slightly faster in header */
        }
        
        #header-logo, #header-logo-back {
            width: 100%;
            height: auto;
            object-fit: contain;
        }
        
        /* Mobile specific styles */
        @media (max-width: 768px) {
            .logo-flip-container:active .logo-flipper {
                transform: rotateY(180deg);
            }
        }
        
        /* Intro info styles */
        .intro-info-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            max-width: 80%;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .intro-content.animate-in .intro-info-container {
            opacity: 1;
            transform: translateY(0);
            transition-delay: 0.6s; /* Appear after slogan */
        }
        
        .intro-info-logo {
            height: 40px;
            width: auto;
            margin-right: 15px;
        }
        
        .intro-info-text {
            font-size: 16px;
            color: #555;
            text-align: left;
            line-height: 1.4;
        }
        
        /* Mobile adjustments for info text */
        @media (max-width: 768px) {
            .intro-info-container {
                flex-direction: column;
                text-align: center;
            }
            
            .intro-info-logo {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .intro-info-text {
                text-align: center;
            }
        }
        
        /* Fix for debug button positioning */
        .toggle-debug-btn {
            position: fixed;
            left: 10px;
            bottom: 10px;
            /* Ensure it stays on top of other content */
            z-index: 999;
        }
        
        /* Settings Panel Styles */
        .settings-panel {
            position: fixed;
            bottom: 50px;
            left: 10px;
            width: 300px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            padding: 15px;
            z-index: 998;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .settings-header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .settings-header h3 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }
        
        .settings-toggles {
            margin-bottom: 20px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .setting-label {
            font-size: 14px;
            color: #555;
        }
        
        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4CAF50;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* Debug Section Styles */
        .debug-section {
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .debug-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .debug-header h4 {
            margin: 0;
            color: #555;
            font-size: 14px;
        }
        
        #debugArea {
            width: 100%;
            height: 150px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }
        
        /* Tooltip for muted controls */
        [data-tooltip] {
            position: relative;
        }
        
        [data-tooltip]:hover:after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
        
        /* Toast Notification Styles */
        .toast-container {
            position: fixed;
            top: 60px; /* Increased from 20px to move toasts down */
            right: 20px;
            z-index: 9999; /* Increased z-index to be above everything else */
        }
        
        .toast {
            min-width: 250px;
            margin-bottom: 10px;
            padding: 12px 20px;
            border-radius: 4px;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 14px;
            opacity: 0;
            transform: translateX(50px);
            transition: all 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .toast-info {
            background-color: #2196F3;
        }
        
        .toast-success {
            background-color: #4CAF50;
        }
        
        .toast-warning {
            background-color: #FF9800;
        }
        
        .toast-error {
            background-color: #F44336;
        }
    </style>
    <script>
        // Ensure page starts at the top
        window.onbeforeunload = function() {
            window.scrollTo(0, 0);
        };
    </script>
</head>
<body>
    <!-- Add audio elements -->
    <audio id="introAudio" preload="auto">
        <source src="picklepairsMain.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <audio id="leaderboardAudio" preload="auto">
        <source src="picklepairsLeaderBoard.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div id="intro-animation" class="intro-container">
        <div class="intro-content">
            <div class="logo-flip-container">
                <div class="logo-flipper">
                    <div class="logo-front">
                        <img src="Picklepairs.png" alt="Pickle Pairs Logo" class="intro-logo">
                    </div>
                    <div class="logo-back">
                        <img src="simplelogot.png" alt="Simple Logo" class="intro-logo back-logo">
                    </div>
                </div>
            </div>
            <h1>Pickle Pairs</h1>
            <p class="slogan">Doing Doubles Right</p>
            
            <!-- Info text container -->
            <div class="intro-info-container">
                <img src="simplelogot.png" alt="Pickle Pairs Logo" class="intro-info-logo">
                <p class="intro-info-text">Pickle Pairs is a Pickleball matchmaking app providing unique pairings every round.</p>
            </div>
            
            <div id="startButton" class="start-button">
                <span class="pickle-icon">ðŸ¥’</span>
                <span>Let's Pickle!</span>
            </div>
            <div class="intro-copyright">
            &copy; 2025 Harrison Engle | Pickle Pairs
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header-logo">
            <div class="logo-flip-container header-logo-flip">
                <div class="logo-flipper">
                    <div class="logo-front">
                        <img src="Picklepairs.png" alt="Pickle Pairs Logo" id="header-logo">
                    </div>
                    <div class="logo-back">
                        <img src="simplelogot.png" alt="Simple Logo" id="header-logo-back" class="back-logo">
                    </div>
                </div>
            </div>
            <h1 id="title">Pickle Pairs</h1>
            <p class="subtitle">Doing Doubles Right</p>
        </div>

        <!-- Player Input Section -->
        <section class="navigation">
            <textarea id="playerInput" placeholder="Enter player names separated by commas or line breaks..."></textarea>
            <div id="playerCount">Player Count: 0</div>
            <div class="navigation-controls">
                <!-- First row - Most important buttons first -->
                <button id="startTournament" class="btn-success">
                    <span class="material-symbols-rounded">sports_tennis</span>
                    START TOURNAMENT
                </button>
                <button id="showPodiumBtn" class="btn-primary">
                    <span class="material-symbols-rounded">leaderboard</span>
                    LEADERBOARD
                </button>
                <button id="addPlayersBtn">
                    <span class="material-symbols-rounded">group_add</span>
                    ADD PLAYERS
                </button>
                <div class="court-select-container">
                    <label for="courtSelect">Courts:</label>
                    <select id="courtSelect">
                        <option value="1">1 Court</option>
                        <option value="2">2 Courts</option>
                        <option value="3">3 Courts</option>
                        <option value="4">4 Courts</option>
                        <option value="5">5 Courts</option>
                        <option value="6">6 Courts</option>
                    </select>
                </div>
                <!-- Second row - Secondary actions -->
                <button id="matchesPlayed">
                    <span class="material-symbols-rounded">history</span>
                    MATCH HISTORY
                </button>
                <button id="captureAllBtn" class="capture-all-btn">
                    <div class="photo-icon-container">
                        <span class="material-symbols-rounded">photo_library</span>
                        <span class="material-symbols-rounded camera-icon">photo_camera</span>
                    </div>
                    CAPTURE ALL
                </button>
            </div>
            
            <!-- Guide Arrow -->
            <div id="guideArrow" class="guide-arrow">
                <div class="guide-arrow-content">
                    <span class="guide-pickle">ðŸ¥’</span>
                    <span class="guide-arrow-point material-symbols-rounded">arrow_downward</span>
                </div>
                <p class="guide-text">Start here!</p>
            </div>
            
            <!-- Import/Export Controls, separated from main navigation -->
            <div class="import-export-controls">
                <button id="exportBtn">
                    <span class="material-symbols-rounded">download</span>
                    EXPORT DATA
                </button>
                <label for="importFile" class="file-input-label">
                    <span class="material-symbols-rounded">upload</span>
                    IMPORT DATA
                    <input type="file" id="importFile" class="hidden" accept=".json">
                </label>
                <button id="clearBtn" class="btn-danger">
                    <span class="material-symbols-rounded">delete</span>
                    CLEAR DATA
                </button>
            </div>
        </section>

        <!-- Round Setup Section -->
        <div class="round-setup">
            <!-- Dynamically populated by JS -->
        </div>

        <!-- Floating Player List Panel -->
        <div id="playerListContainer" class="floating-panel">
            <h2>Players</h2>
            <div id="playerListContainerTable">
                <table id="playerTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="playerList"></tbody>
                </table>
            </div>
        </div>
        <button id="togglePlayerList" class="toggle-btn" aria-label="Toggle player list">
            <span class="material-symbols-rounded">people</span>
        </button>

        <!-- Floating Leaderboard Button -->
        <button id="floatingLeaderboardBtn" class="toggle-btn leaderboard-btn" aria-label="Show leaderboard">
            <span class="material-symbols-rounded">emoji_events</span>
        </button>

        <!-- Current Round Button -->
        <button id="scrollToCurrentRound" class="round-nav-btn" aria-label="Scroll to current round">
            <span class="material-symbols-rounded">arrow_downward</span>
            <span class="btn-text">Current Round</span>
        </button>

        <!-- Match Display Section -->
        <div id="matchDisplay" class="match-display"></div>

        <!-- Footer with extra space for proper scrolling -->
        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Pickle Pairs</h3>
                    <p>Pickle Pairs is designed to help organize and track pickleball matches dynamically, avoiding repeat pairs and unique matches until all matches are exhausted. It also keeps track of player stats, has match history, a leaderboard, and ensures fair play.</p>
                
                </div>
                <div class="footer-section">
                    <h3>Coming Soon</h3>
                    <ul>
                        <li>Bug Reports</li>
                        <li>Feature Requests</li>
                        <li>Contact / Support</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact & Support</h3>
                    
    <iframe
    id="JotFormIFrame-250965783330462"
    title="Pickle Pairs - Bug Tracker and Recommendations"
    onload="window.parent.scrollTo(0,0)"
    allowtransparency="true"
    allow="geolocation; microphone; camera; fullscreen"
    src="https://form.jotform.com/250965783330462"
    frameborder="0"
    style="min-width:100%;max-width:100%;height:539px;border:none;"
    scrolling="no"
  >
  </iframe>
  <script src='https://cdn.jotfor.ms/s/umd/latest/for-form-embed-handler.js'></script>
  <script>window.jotformEmbedHandler("iframe[id='JotFormIFrame-250965783330462']", "https://form.jotform.com/")</script>
  
                    <p>For bugs, check the Debug Log (Gear icon) and copy it to your clipboard using the copy button, and paste it in the debug log section on the Bug Tracker Form.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Pickle Pairs - Harrison Engle - All rights reserved.</p>
            </div>
        </footer>

        <!-- Podium Display Section -->
        <div id="podiumDisplay" class="podium-container">
            <h2>Pickle Board</h2>
            <div id="dateDisplay"></div>
            
            <button id="saveAsPictureBtn" class="save-picture-btn">
                <span class="material-symbols-rounded">photo_camera</span> <span>Save as Image</span>
            </button>
            <button id="toggleLeaderboardMute" class="toggle-mute-btn">
                <span class="material-symbols-rounded">volume_up</span>
            </button>
            <button id="closePodiumBtn">
                <span class="material-symbols-rounded">close</span>
            </button>

            <!-- Sorting Buttons -->
            <div class="sorting-buttons">
                <button id="sortVictoryPoints">Victory Points</button>
                <button id="sortPicklePoints">Pickle Points</button>
                <button id="sortWinPercentage">Win %</button>
                <button id="sortPicklePointAvg">Pickle Points Avg</button>
                <button id="sortPickleDifferential">Pickle Differential</button>
            </div>

            <!-- Podium Standings -->
            <div class="podium">
                <div class="podium-place silver">
                    <div class="placementtitle">ðŸ¥ˆ</div>
                    <div class="player-name" id="silver"></div>
                </div>
                <div class="podium-place gold">
                    <div class="confetti-container">
                        <div class="confetti"></div>
                        <div class="confetti"></div>
                        <div class="confetti"></div>
                        <div class="confetti"></div>
                        <div class="confetti"></div>
                    </div>
                    <div class="placementtitle">ðŸ¥‡</div>
                    <div class="player-name" id="gold"></div>
                </div>
                <div class="podium-place bronze">
                    <div class="placementtitle">ðŸ¥‰</div>
                    <div class="player-name" id="bronze"></div>
                </div>
            </div>

            <!-- Player Stats Table -->
            <table id="playerStatsTable">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Name</th>
                        <th>Games</th>
                        <th>Victory Pts</th>
                        <th>Win %</th>
                        <th>Pickle Pts</th>
                        <th>Differential</th>
                        <th>Pt Avg</th>
                        <th>Teammates</th>
                        <th>Versus</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamically filled by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Match History Modal -->
        <div id="matchHistoryDisplay">
            <h2>Match History</h2>
            <button id="saveMatchHistoryAsPictureBtn" class="save-picture-btn">
                <span class="material-symbols-rounded">photo_camera</span> Save as Image
            </button>
            <div id="matchHistoryContent"></div>
            <button id="closeMatchHistoryBtn">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>

        <!-- Back to top button -->
        <button id="backToTopBtn" class="back-to-top-btn">
            <span class="material-symbols-rounded">arrow_upward</span>
        </button>
        
        <!-- Main audio mute button -->
        <button id="toggleMainAudioBtn" class="toggle-mute-btn fixed-position">
            <span class="material-symbols-rounded">volume_up</span>
        </button>
        
        <!-- Debug toggle button - rename to settings -->
        <button id="toggleDebugBtn" class="toggle-debug-btn">
            <span class="material-symbols-rounded">settings</span>
        </button>
        
        <!-- Settings container (formerly debug area) -->
        <div id="debugAreaContainer" style="display: none;" class="settings-panel">
            <div class="settings-header">
                <h3>Settings</h3>
            </div>
            
            <div class="settings-toggles">
                <!-- Skip Intro Toggle -->
                <div class="setting-item">
                    <label for="skipIntroToggle" class="setting-label">Skip Intro Animation</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="skipIntroToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <!-- Mute All Sounds Toggle -->
                <div class="setting-item">
                    <label for="muteAllSoundsToggle" class="setting-label">Mute All Sounds</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="muteAllSoundsToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="debug-section">
                <div class="debug-header">
                    <h4>Debug Log</h4>
                    <button id="copyDebugBtn" class="copy-debug-btn">
                        <span class="material-symbols-rounded">content_copy</span>
                    </button>
                </div>
                <textarea id="debugArea" readonly></textarea>
            </div>
        </div>
    </div>

    <script>
        // Intro animation with audio
        document.addEventListener('DOMContentLoaded', function() {
            const introContainer = document.getElementById('intro-animation');
            const introContent = introContainer.querySelector('.intro-content');
            const startButton = document.getElementById('startButton');
            const introAudio = document.getElementById('introAudio');
            const toggleMainAudioBtn = document.getElementById('toggleMainAudioBtn');
            
            // Setup audio state variables first
            let isMainAudioMuted = localStorage.getItem('isMainAudioMuted') === 'true';
            let isLeaderboardMuted = localStorage.getItem('isLeaderboardAudioMuted') === 'true';
            
            // Add debug logging for settings values
            console.log('Initial settings values:', {
                isMainAudioMuted,
                isLeaderboardMuted,
                skipIntro: localStorage.getItem('skipIntro') === 'true',
                muteAllSounds: localStorage.getItem('muteAllSounds') === 'true'
            });
            
            // Initialize settings toggles
            const skipIntroToggle = document.getElementById('skipIntroToggle');
            const muteAllSoundsToggle = document.getElementById('muteAllSoundsToggle');
            
            // Check localStorage for settings
            let skipIntro = localStorage.getItem('skipIntro') === 'true';
            let muteAllSounds = localStorage.getItem('muteAllSounds') === 'true';
            
            // Set initial toggle states
            skipIntroToggle.checked = skipIntro;
            muteAllSoundsToggle.checked = muteAllSounds;
            
            // Apply skip intro setting if enabled
            if (skipIntro) {
                introContainer.style.display = 'none';
                showGuideArrow();
            }
            
            // Apply mute all sounds setting if enabled
            if (muteAllSounds) {
                // Set muted state for both audio elements
                isMainAudioMuted = true;
                isLeaderboardMuted = true;
                
                // Update localStorage
                localStorage.setItem('isMainAudioMuted', 'true');
                localStorage.setItem('isLeaderboardAudioMuted', 'true');
                
                // Update UI
                toggleMainAudioBtn.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                toggleMainAudioBtn.classList.add('muted');
                toggleMainAudioBtn.setAttribute('data-tooltip', 'Turned off in settings - gear icon');
                
                // Also update leaderboard mute button if it exists
                const toggleLeaderboardMute = document.getElementById('toggleLeaderboardMute');
                if (toggleLeaderboardMute) {
                    toggleLeaderboardMute.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                    toggleLeaderboardMute.classList.add('muted');
                    toggleLeaderboardMute.setAttribute('data-tooltip', 'Turned off in settings - gear icon');
                }
            }
            
            // Add event listeners for settings toggles
            skipIntroToggle.addEventListener('change', function() {
                skipIntro = this.checked;
                localStorage.setItem('skipIntro', skipIntro.toString());
                
                // Log to debug area
                const debugArea = document.getElementById('debugArea');
                if (debugArea) {
                    const timestamp = new Date().toISOString();
                    debugArea.value += `${timestamp} - Skip intro setting changed to: ${skipIntro}\n`;
                    // Scroll to bottom
                    debugArea.scrollTop = debugArea.scrollHeight;
                }
                
                // Clear console log for debugging
                console.log(`Skip intro toggled to: ${skipIntro}`);
                console.log('Current localStorage value:', localStorage.getItem('skipIntro'));
            });
            
            muteAllSoundsToggle.addEventListener('change', function() {
                muteAllSounds = this.checked;
                localStorage.setItem('muteAllSounds', muteAllSounds.toString());
                
                // Clear console log for debugging
                console.log(`Mute all sounds toggled to: ${muteAllSounds}`);
                console.log('Current localStorage value:', localStorage.getItem('muteAllSounds'));
                
                // Update audio states based on this master setting
                if (muteAllSounds) {
                    // Save current states before muting everything
                    localStorage.setItem('previousMainAudioState', isMainAudioMuted.toString());
                    localStorage.setItem('previousLeaderboardAudioState', isLeaderboardMuted.toString());
                    
                    console.log('Saved previous audio states:', {
                        mainAudio: isMainAudioMuted,
                        leaderboardAudio: isLeaderboardMuted
                    });
                    
                    // Mute all audio elements
                    isMainAudioMuted = true;
                    isLeaderboardMuted = true;
                    
                    // Update localStorage
                    localStorage.setItem('isMainAudioMuted', 'true');
                    localStorage.setItem('isLeaderboardAudioMuted', 'true');
                    
                    // Update UI
                    toggleMainAudioBtn.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                    toggleMainAudioBtn.classList.add('muted');
                    toggleMainAudioBtn.setAttribute('data-tooltip', 'Turned off in settings - gear icon');
                    
                    // Also update leaderboard mute button if it exists
                    const toggleLeaderboardMute = document.getElementById('toggleLeaderboardMute');
                    if (toggleLeaderboardMute) {
                        toggleLeaderboardMute.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                        toggleLeaderboardMute.classList.add('muted');
                        toggleLeaderboardMute.setAttribute('data-tooltip', 'Turned off in settings - gear icon');
                    }
                    
                    // Stop any playing audio
                    fadeOutIntroAudio(true);
                    stopLeaderboardAudio();
                } else {
                    // Restore previous audio states
                    const previousMainAudioState = localStorage.getItem('previousMainAudioState') === 'true';
                    const previousLeaderboardAudioState = localStorage.getItem('previousLeaderboardAudioState') === 'true';
                    
                    console.log('Restoring previous audio states:', {
                        mainAudio: previousMainAudioState,
                        leaderboardAudio: previousLeaderboardAudioState
                    });
                    
                    // Set audio states to previous values
                    isMainAudioMuted = previousMainAudioState;
                    isLeaderboardMuted = previousLeaderboardAudioState;
                    
                    // Update localStorage
                    localStorage.setItem('isMainAudioMuted', isMainAudioMuted.toString());
                    localStorage.setItem('isLeaderboardAudioMuted', isLeaderboardMuted.toString());
                    
                    // Update main audio UI
                    toggleMainAudioBtn.removeAttribute('data-tooltip');
                    if (isMainAudioMuted) {
                        toggleMainAudioBtn.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                        toggleMainAudioBtn.classList.add('muted');
                    } else {
                        toggleMainAudioBtn.querySelector('.material-symbols-rounded').textContent = 'volume_up';
                        toggleMainAudioBtn.classList.remove('muted');
                    }
                    
                    // Update leaderboard mute UI if it exists
                    const toggleLeaderboardMute = document.getElementById('toggleLeaderboardMute');
                    if (toggleLeaderboardMute) {
                        toggleLeaderboardMute.removeAttribute('data-tooltip');
                        if (isLeaderboardMuted) {
                            toggleLeaderboardMute.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                            toggleLeaderboardMute.classList.add('muted');
                        } else {
                            toggleLeaderboardMute.querySelector('.material-symbols-rounded').textContent = 'volume_up';
                            toggleLeaderboardMute.classList.remove('muted');
                        }
                    }
                }
                
                // Log to debug area
                const debugArea = document.getElementById('debugArea');
                if (debugArea) {
                    const timestamp = new Date().toISOString();
                    debugArea.value += `${timestamp} - Mute all sounds setting changed to: ${muteAllSounds}\n`;
                    // Scroll to bottom
                    debugArea.scrollTop = debugArea.scrollHeight;
                }
                
                // Show toast for user feedback
                showToast(`All sounds ${muteAllSounds ? 'muted' : 'enabled'}`, "info", 2000);
            });
            
            // Update toggle main audio button click handler to respect the global setting
            toggleMainAudioBtn.addEventListener('click', function() {
                if (muteAllSounds) {
                    // Show a toast notification
                    showToast("Sound is disabled in settings. Check the gear icon to enable.", "info", 3000);
                    return;
                }
                
                isMainAudioMuted = !isMainAudioMuted;
                localStorage.setItem('isMainAudioMuted', isMainAudioMuted.toString());
                
                // Log for debugging
                console.log(`Main audio muted toggled to: ${isMainAudioMuted}`);
                console.log('Current localStorage value:', localStorage.getItem('isMainAudioMuted'));
                
                if (isMainAudioMuted) {
                    // Change icon to muted
                    toggleMainAudioBtn.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                    toggleMainAudioBtn.classList.add('muted');
                    // Stop audio if it's playing
                    fadeOutIntroAudio(true);
                } else {
                    // Change icon to unmuted
                    toggleMainAudioBtn.querySelector('.material-symbols-rounded').textContent = 'volume_up';
                    toggleMainAudioBtn.classList.remove('muted');
                }
            });
            
            // Setup logo flip click behavior
            const logoFlipContainers = document.querySelectorAll('.logo-flip-container');
            logoFlipContainers.forEach(container => {
                // We'll keep a simpler implementation that works well with CSS hover
                container.addEventListener('click', function(e) {
                    // This is primarily for mobile devices
                    // Desktop will use CSS :hover state
                });
            });
            
            // Update toggle button icon based on mute state
            if (isMainAudioMuted) {
                toggleMainAudioBtn.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                toggleMainAudioBtn.classList.add('muted');
            } else {
                toggleMainAudioBtn.querySelector('.material-symbols-rounded').textContent = 'volume_up';
                toggleMainAudioBtn.classList.remove('muted');
            }
            
            // Start the intro animation immediately on page load
            // This will animate in the logo, title, slogan, and button
            setTimeout(function() {
                introContent.classList.add('animate-in');
            }, 100);
            
            // Add click event to start button to begin the transition to the main app
            startButton.addEventListener('click', function() {
                // Add the clicked class to trigger the button animation
                startButton.classList.add('clicked');
                
                // Start the audio only if not muted
                if (!isMainAudioMuted) {
                    introAudio.volume = 1.0;
                    introAudio.play().catch(error => {
                        console.log('Audio playback was prevented by the browser:', error);
                    });
                    
                    // Start fading audio after 7 seconds
                    setTimeout(() => {
                        // Gradually fade out audio over 3 seconds
                        fadeOutIntroAudio();
                    }, 7000);
                }
                
                // Trigger animation out after a short delay to allow button animation to complete
                setTimeout(function() {
                    introContainer.classList.add('animate-out');
                    
                    // Remove the intro container from DOM after animation completes
                    setTimeout(function() {
                        introContainer.style.display = 'none';
                        
                        // Show guide arrow after intro animation completes
                        showGuideArrow();
                    }, 1000); // Should match the CSS transition duration
                }, 600);
            });
            
            // Leaderboard audio functionality
            const leaderboardAudio = document.getElementById('leaderboardAudio');
            const showPodiumBtn = document.getElementById('showPodiumBtn');
            const floatingLeaderboardBtn = document.getElementById('floatingLeaderboardBtn');
            const closePodiumBtn = document.getElementById('closePodiumBtn');
            const toggleLeaderboardMute = document.getElementById('toggleLeaderboardMute');
            
            // Update toggle button icon based on mute state
            if (isLeaderboardMuted) {
                toggleLeaderboardMute.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                toggleLeaderboardMute.classList.add('muted');
            } else {
                toggleLeaderboardMute.querySelector('.material-symbols-rounded').textContent = 'volume_up';
                toggleLeaderboardMute.classList.remove('muted');
            }
            
            // Function to quickly fade out intro audio
            function fadeOutIntroAudio(immediate = false) {
                if (introAudio.paused) return;
                
                const duration = immediate ? 50 : 300; // Faster fade if immediate is true
                const decrement = immediate ? 0.2 : 0.1; // Larger decrement if immediate
                
                // Fade out intro audio
                const fadeInterval = setInterval(() => {
                    if (introAudio.volume > 0.1) {
                        introAudio.volume -= decrement;
                    } else {
                        clearInterval(fadeInterval);
                        introAudio.pause();
                        introAudio.volume = 1.0; // Reset volume for future use
                    }
                }, duration);
            }
            
            // Function to play leaderboard audio
            function playLeaderboardAudio() {
                // First fade out intro audio if it's playing
                fadeOutIntroAudio();
                
                if (!isLeaderboardMuted) {
                    leaderboardAudio.volume = 1.0;
                    leaderboardAudio.currentTime = 0; // Reset to beginning
                    leaderboardAudio.play().catch(error => {
                        console.log('Leaderboard audio playback was prevented by the browser:', error);
                    });
                }
            }
            
            // Function to stop leaderboard audio with fade out
            function stopLeaderboardAudio() {
                if (leaderboardAudio.paused) return;
                
                // Fade out audio over 1 second
                const fadeInterval = setInterval(() => {
                    if (leaderboardAudio.volume > 0.1) {
                        leaderboardAudio.volume -= 0.1;
                    } else {
                        clearInterval(fadeInterval);
                        leaderboardAudio.pause();
                        leaderboardAudio.currentTime = 0;
                    }
                }, 100);
            }
            
            // Play audio when leaderboard is opened
            showPodiumBtn.addEventListener('click', playLeaderboardAudio);
            floatingLeaderboardBtn.addEventListener('click', playLeaderboardAudio);
            
            // Stop audio when leaderboard is closed
            closePodiumBtn.addEventListener('click', stopLeaderboardAudio);
            
            // Toggle mute button functionality
            toggleLeaderboardMute.addEventListener('click', function() {
                if (muteAllSounds) {
                    // Show a toast notification
                    showToast("Sound is disabled in settings. Check the gear icon to enable.", "info", 3000);
                    return;
                }
                
                isLeaderboardMuted = !isLeaderboardMuted;
                localStorage.setItem('isLeaderboardAudioMuted', isLeaderboardMuted.toString());
                
                // Log for debugging
                console.log(`Leaderboard audio muted toggled to: ${isLeaderboardMuted}`);
                console.log('Current localStorage value:', localStorage.getItem('isLeaderboardAudioMuted'));
                
                if (isLeaderboardMuted) {
                    // Change icon to muted
                    toggleLeaderboardMute.querySelector('.material-symbols-rounded').textContent = 'volume_off';
                    toggleLeaderboardMute.classList.add('muted');
                    stopLeaderboardAudio();
                } else {
                    // Change icon to unmuted
                    toggleLeaderboardMute.querySelector('.material-symbols-rounded').textContent = 'volume_up';
                    toggleLeaderboardMute.classList.remove('muted');
                    
                    // Only start playing if the podium is currently visible
                    if (document.getElementById('podiumDisplay').classList.contains('active')) {
                        playLeaderboardAudio();
                    }
                }
            });
            
            // Function to show toast notifications
            function showToast(message, type = 'info', duration = 3000) {
                const toastContainer = document.getElementById('toastContainer');
                
                // Create toast element
                const toast = document.createElement('div');
                toast.classList.add('toast', `toast-${type}`);
                toast.textContent = message;
                
                // Add to container
                toastContainer.appendChild(toast);
                
                // Show with animation
                setTimeout(() => toast.classList.add('show'), 10);
                
                // Remove after duration
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toastContainer.removeChild(toast), 300);
                }, duration);
            }
        });
        
        // Function to show the guide arrow and handle its behavior
        function showGuideArrow() {
            const guideArrow = document.getElementById('guideArrow');
            const playerInput = document.getElementById('playerInput');
            const continueTournamentBtn = document.getElementById('startTournament'); // This is the "CONTINUE TOURNAMENT" button
            
            // Check for visible data in the Round 1 section which indicates loaded data
            const hasVisibleTournament = document.querySelector('.round-container') !== null;
            
            // Also check localStorage as backup method
            let hasStoredData = false;
            try {
                const storedData = localStorage.getItem('tournamentData');
                if (storedData) {
                    const parsedData = JSON.parse(storedData);
                    hasStoredData = parsedData && parsedData.players && parsedData.players.length > 0;
                }
            } catch (e) {
                console.error("Error checking tournament data:", e);
            }
            
            // Either visible tournament or stored data means we should point to the continue button
            const hasData = hasVisibleTournament || hasStoredData;
            console.log("Guide arrow check - visible tournament:", hasVisibleTournament, "stored data:", hasStoredData);
            
            // Target element based on whether data is loaded
            const targetElement = hasData ? continueTournamentBtn : playerInput;
            const targetText = hasData ? "Continue!" : "Start here!";
            
            // Position function that will be called on resize and scroll too
            function positionArrow() {
                const elementRect = targetElement.getBoundingClientRect();
                const arrowIcon = document.querySelector('.guide-arrow-point');
                
                if (hasData) {
                    // For continue tournament button - position to left of button, centered vertically
                    guideArrow.style.top = `${elementRect.top + (elementRect.height / 2) - (guideArrow.offsetHeight / 2)}px`;
                    const leftPosition = Math.max(10, elementRect.left - guideArrow.offsetWidth - 20);
                    guideArrow.style.left = `${leftPosition}px`;
                    
                    // Change to east arrow for pointing to the continue button
                    arrowIcon.textContent = "east";
                    arrowIcon.style.animation = "point-arrow-right 1s ease-in-out infinite";
                } else {
                    // For player input textarea - position above the LEFT side of the input
                    guideArrow.style.top = `${elementRect.top - guideArrow.offsetHeight - 15}px`;
                    guideArrow.style.left = `${elementRect.left + 30}px`;
                    
                    // Use downward arrow for pointing to the text field
                    arrowIcon.textContent = "arrow_downward";
                    arrowIcon.style.animation = "point-arrow-down 1s ease-in-out infinite";
                }
                
                // Update text
                guideArrow.querySelector('.guide-text').textContent = targetText;
            }
            
            // Make the arrow visible first
            guideArrow.classList.add('visible');
            
            // Position initially after a tiny delay to ensure visibility
            setTimeout(positionArrow, 50);
            
            // Reposition on window resize and scroll
            window.addEventListener('resize', positionArrow);
            window.addEventListener('scroll', positionArrow);
            
            // Remove the arrow after 10 seconds
            setTimeout(() => {
                guideArrow.classList.remove('visible');
                // Remove event listeners
                window.removeEventListener('resize', positionArrow);
                window.removeEventListener('scroll', positionArrow);
                
                // Remove from DOM after animation
                setTimeout(() => {
                    guideArrow.remove();
                }, 500);
            }, 10000);
        }
        
        // Define the scroll to top function and make it globally accessible
        window.scrollTop = function() { 
            document.body.scrollTop = document.documentElement.scrollTop = 0; 
        }
        
        // Add event listener to the back to top button
        document.getElementById('backToTopBtn').addEventListener('click', scrollTop);
        
        // Add event listener for the debug toggle button
        document.getElementById('toggleDebugBtn').addEventListener('click', function() {
            const debugArea = document.getElementById('debugAreaContainer');
            debugArea.style.display = debugArea.style.display === 'none' ? 'block' : 'none';
        });
        
        // Add event listener for the copy debug button
        document.getElementById('copyDebugBtn').addEventListener('click', function() {
            const debugText = document.getElementById('debugArea').value;
            if (debugText) {
                navigator.clipboard.writeText(debugText)
                    .then(() => {
                        // Visual feedback that copy was successful
                        const copyBtn = document.getElementById('copyDebugBtn');
                        copyBtn.innerHTML = '<span class="material-symbols-rounded">check</span>';
                        setTimeout(() => {
                            copyBtn.innerHTML = '<span class="material-symbols-rounded">content_copy</span>';
                        }, 1500);
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                        showToast('Failed to copy debug log to clipboard', 'error');
                    });
            }
        });
        
        // Function to capture all content of an element as an image
        function captureElementAsImage(element, filename) {
            // Add the photo-capture-mode class to ensure all content is visible
            element.classList.add('photo-capture-mode');
            
            // Save the original styles
            const originalStyle = element.style.cssText;
            
            // Capture all content with html2canvas
            html2canvas(element, {
                scrollX: 0,
                scrollY: 0,
                windowWidth: element.scrollWidth,
                windowHeight: element.scrollHeight,
                scale: 2, // Higher resolution
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#FFFFFF'
            }).then((canvas) => {
                // Remove the photo-capture-mode class and restore original styles
                element.classList.remove('photo-capture-mode');
                element.style.cssText = originalStyle;
                
                // Create download link
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                const currentDate = new Date().toISOString().slice(0, 10);
                link.download = `${filename}-${currentDate}.png`;
                link.click();
            });
        }
        
        // Add event listener for the Match History save as image button
        document.getElementById('saveMatchHistoryAsPictureBtn').addEventListener('click', function() {
            const matchHistoryDisplay = document.getElementById('matchHistoryDisplay');
            captureElementAsImage(matchHistoryDisplay, 'match-history');
        });
        
        // Add event listener for the Capture All button
        document.getElementById('captureAllBtn').addEventListener('click', function() {
            // Show both displays temporarily
            const podiumDisplay = document.getElementById('podiumDisplay');
            const matchHistoryDisplay = document.getElementById('matchHistoryDisplay');
            
            // First show the podium and capture it
            podiumDisplay.classList.add('active');
            captureElementAsImage(podiumDisplay, 'leaderboard');
            
            // Then show the match history and capture it (after a slight delay)
            setTimeout(function() {
                podiumDisplay.classList.remove('active');
                matchHistoryDisplay.classList.add('active');
                
                captureElementAsImage(matchHistoryDisplay, 'match-history');
                
                // Hide match history after another delay
                setTimeout(function() {
                    matchHistoryDisplay.classList.remove('active');
                }, 500);
            }, 1000);
        });
    </script>
    
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</body>
</html>
